!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).lazyframe=e()}(this,(function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}return function(){var e,n=[],i={vendor:void 0,id:void 0,src:void 0,thumbnail:void 0,title:void 0,initialized:!1,lazyload:!0,autoplay:!0,initinview:!1,onLoad:function(t){},onAppend:function(t){},onThumbnailLoad:function(t){}},o={regex:{youtube_nocookie:/(?:youtube-nocookie\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\?(?:\S*?&?v\=)))([a-zA-Z0-9_-]{6,11})/,youtube:/(?:youtube\.com\/\S*(?:(?:\/e(?:mbed))?\/|watch\?(?:\S*?&?v\=))|youtu\.be\/)([a-zA-Z0-9_-]{6,11})/,vimeo:/vimeo\.com\/(?:video\/)?([0-9]*)(?:\?|)/},condition:{youtube:function(t){return!(!t||11!=t[1].length)&&t[1]},youtube_nocookie:function(t){return!(!t||11!=t[1].length)&&t[1]},vimeo:function(t){return!!(t&&9===t[1].length||8===t[1].length)&&t[1]}},src:{youtube:function(t){return"https://www.youtube.com/embed/".concat(t.id,"/?autoplay=").concat(t.autoplay?"1":"0","&").concat(t.query)},youtube_nocookie:function(t){return"https://www.youtube-nocookie.com/embed/".concat(t.id,"/?autoplay=").concat(t.autoplay?"1":"0","&").concat(t.query)},vimeo:function(t){return"https://player.vimeo.com/video/".concat(t.id,"/?autoplay=").concat(t.autoplay?"1":"0","&").concat(t.query)}},endpoint:function(t){return"https://noembed.com/embed?url=".concat(t.src)},response:{title:function(t){return t.title},thumbnail:function(t){return t.thumbnail_url}}};function a(t){var n=this;if(t instanceof HTMLElement!=!1&&!t.classList.contains("lazyframe--loaded")){var i={el:t,settings:r(t)};i.el.addEventListener("click",(function(){i.el.appendChild(i.iframe),i.el.classList.add("lazyframe--activated");var e=t.querySelector("iframe");i.settings.onAppend.call(n,e)})),e.lazyload?u(i):c(i,i.settings.thumbnail)}}function r(n){var i,a,r=Array.prototype.slice.apply(n.attributes).filter((function(t){return""!==t.value})).reduce((function(t,e){return t[0===e.name.indexOf("data-")?e.name.split("data-")[1]:e.name]=e.value,t}),{}),c=t({},e,r,{y:n.offsetTop,originalSrc:r.src,query:(i=r.src,a=i.split("?"),a[1]?a[1]:null)});if(c.vendor){var l=c.src.match(o.regex[c.vendor]);c.id=o.condition[c.vendor](l)}return c}function c(t){var e=this;!function(t){return!(!t.vendor||t.title&&t.thumbnail)}(t.settings)?u(t,!0):function(t,e){var n=o.endpoint(t.settings),i=new XMLHttpRequest;i.open("GET",n,!0),i.onload=function(){if(i.status>=200&&i.status<400){var n=JSON.parse(i.responseText);e(null,[n,t])}else e(!0)},i.onerror=function(){e(!0)},i.send()}(t,(function(n,i){if(!n){var a=i[0],r=i[1];if(r.settings.title||(r.settings.title=o.response.title(a)),!r.settings.thumbnail){var c=o.response.thumbnail(a);r.settings.thumbnail=c,t.settings.onThumbnailLoad.call(e,c)}u(r,!0)}}))}function l(){var t=this,e=function(e){e.settings.initialized=!0,e.el.classList.add("lazyframe--loaded"),e.el.appendChild(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Play",e=document.createElement("button");return e.type="button",e.classList.add("lf-play-btn"),e.innerHTML='<span class="visually-hidden">'.concat(t,"</span>"),e}()),c(e),e.settings.initinview&&e.el.click(),e.settings.onLoad.call(t,e)};if("IntersectionObserver"in window){var i=new IntersectionObserver((function(t){t.forEach((function(t){if(t.isIntersecting){var o=n.find((function(e){return e.el==t.target}));e(o),i.unobserve(t.target)}}))}));n.forEach((function(t){i.observe(t.el)}))}else n.forEach((function(t){e(t)}))}function u(t,i){if(t.iframe=function(t){var e=document.createDocumentFragment(),n=document.createElement("iframe");t.vendor&&(t.src=o.src[t.vendor](t));n.setAttribute("id","lazyframe-".concat(t.id)),n.setAttribute("src",t.src),n.setAttribute("frameborder",0),n.setAttribute("allowfullscreen",""),t.autoplay&&(n.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture");return e.appendChild(n),e}(t.settings),t.settings.thumbnail&&i){var a=t.settings.thumbnail,r="url(".concat(a,") 1x");(a=a.replace(/\s/g,"").split(",")).length>1&&(r="url(".concat(a[0],") 1x, url(").concat(a[1],") 1x")),t.el.style.backgroundImage="-webkit-image-set(".concat(r,")")}if(t.settings.title&&0===t.el.children.length){var c=document.createDocumentFragment(),l=document.createElement("span");l.className="lazyframe__title",l.innerHTML=t.settings.title,c.appendChild(l),t.el.appendChild(c)}e.lazyload||(t.el.classList.add("lazyframe--loaded"),t.settings.onLoad.call(this,t),n.push(t)),t.settings.initialized||n.push(t)}return function(n){if(e=t({},i,arguments.length<=1?void 0:arguments[1]),"string"==typeof n)for(var o=document.querySelectorAll(n),r=0;r<o.length;r++)a(o[r]);else if(void 0===n.length)a(n);else for(var c=0;c<n.length;c++)a(n[c]);e.lazyload&&l()}}()}));
